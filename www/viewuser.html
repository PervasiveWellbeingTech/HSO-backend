<!DOCTYPE html>
<html>
<head>
  <title></title>
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/google-chart/google-chart.html">
</head>

<body>

<style>
#days_ago_to_num_installs {
  width: 100%;
}

#days_ago_to_num_uninstalls {
  width: 100%;
}

#install_primary_language {
  width: 100%;
}

#install_country {
  width: 100%;
}

#install_source {
  width: 100%;
}
</style>

<div>User ID: <span id="display_user_id"></span></div>
<div>Install time: <span id="display_install_time"></span></div>
<div>Uninstall time: <span id="display_uninstall_time"></span></div>
<div>Enabled goals: 
  <div id="enabled_goals_list"></div>
</div>
<div>Enabled interventions:
  <div id="enabled_interventions_list"></div>
</div>
<div>Dates active:
  <div id="dates_active_list"></div>
</div>
<!--
<google-chart id="days_ago_to_num_installs" cols='[{"label": "Data", "type": "string"},{"label": "Installs", "type": "number"}]' rows='[["Something", 1]]'></google-chart>

<google-chart id="days_ago_to_num_uninstalls" cols='[{"label": "Data", "type": "string"},{"label": "Uninstalls", "type": "number"}]' rows='[["Something", 1]]'></google-chart>

<google-chart id="install_primary_language" cols='[{"label": "Data", "type": "string"},{"label": "Languages", "type": "number"}]' rows='[["Something", 1]]'></google-chart>

<google-chart id="install_country" cols='[{"label": "Data", "type": "string"},{"label": "Country", "type": "number"}]' rows='[["Something", 1]]'></google-chart>

<google-chart id="install_source" cols='[{"label": "Data", "type": "string"},{"label": "Installs", "type": "number"}]' rows='[["Something", 1]]'></google-chart>
-->

<script src="bower_components/moment/moment.js"></script>
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script src="libfrontend.js"></script>
<script src="npm_libs/geturlparameters.js"></script>
<script>

let user_id = geturlparameters().userid

async function show_basic_stats() {
  $('#display_user_id').text(user_id)
  let user_to_install_times = await get_user_to_install_times()
  let user_to_uninstall_times = await get_user_to_uninstall_times()
  let install_time = user_to_install_times[user_id]
  let uninstall_time = user_to_uninstall_times[user_id]
  if (install_time != null) {
    $('#display_install_time').text(moment(install_time).toString())
  } else {
    $('#display_install_time').text('No install record')
  }
  if (uninstall_time != null) {
    $('#display_uninstall_time').text(moment(uninstall_time).toString())
  } else {
    $('#display_uninstall_time').text('No uninstall record')
  }
}

async function show_enabled_goals() {
  let enabled_goals = await get_enabled_goals_for_user(user_id)
  $('#enabled_goals_list').text(JSON.stringify(enabled_goals))
  //'http://localhost:5000/printcollection?userid=c0c064d1b0c94e04b57b451c&logname=logs:goals'
}

async function show_enabled_interventions() {
  let enabled_interventions = await get_enabled_interventions_for_user(user_id)
  $('#enabled_interventions_list').text(JSON.stringify(enabled_interventions))
}

async function show_dates_active() {
  let dates_active = await get_dates_active(user_id)
  $('#dates_active_list').text(JSON.stringify(dates_active))
}

async function main() {
  if (!user_id) {
    console.log('need userid parameter')
    return
  }
  show_basic_stats()
  show_enabled_goals()
  show_enabled_interventions()
  show_dates_active()
}

main();
</script>

</body>
</html>